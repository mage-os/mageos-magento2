<?xml version="1.0" encoding="utf-8"?>
<!--
/**
 * Copyright 2025 Adobe
 * All Rights Reserved.
 */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">

    <test name="AdminUserCreationPasswordLengthValidationTest">
        <annotations>
            <features value="User"/>
            <stories value="Admin Password Length Configuration"/>
            <title value="Admin user creation respects minimum password length configuration"/>
            <description value="Admin should not be able to create users with passwords shorter than configured minimum length"/>
            <severity value="AVERAGE"/>
            <testCaseId value="AC-15232"/>
            <useCaseId value="ACP2E-4044"/>
            <group value="user"/>
            <group value="configuration"/>
        </annotations>

        <before>
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
            <!-- Set minimum password length to 12 -->
            <actionGroup ref="AdminNavigateToSecurityConfigActionGroup" stepKey="navigateToSecurityConfig"/>
            <actionGroup ref="AdminSetMinimumPasswordLengthActionGroup" stepKey="setPasswordLength">
                <argument name="passwordLength" value="12"/>
            </actionGroup>
            <actionGroup ref="AdminSaveConfigActionGroup" stepKey="saveConfig"/>
        </before>

        <after>
            <!-- Delete created user if it exists -->
            <actionGroup ref="AdminDeleteUserActionGroup" stepKey="deleteUser">
                <argument name="user" value="testUserShortPassword"/>
            </actionGroup>
            <!-- Reset configuration to default -->
            <actionGroup ref="AdminNavigateToSecurityConfigActionGroup" stepKey="navigateToConfig"/>
            <checkOption selector="{{AdminSecurityConfigSection.minimumPasswordLengthInherit}}" stepKey="resetLengthToDefault"/>
            <actionGroup ref="AdminSaveConfigActionGroup" stepKey="resetConfig"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>

        <!-- Fill user form with basic information -->
        <actionGroup ref="AdminFillNewUserFormActionGroup" stepKey="fillUserForm">
            <argument name="user" value="testUserShortPassword"/>
        </actionGroup>

        <!-- Test with invalid password (7 characters, less than configured 12) -->
        <actionGroup ref="AdminSetUserPasswordAndTestValidationActionGroup" stepKey="testInvalidPassword">
            <argument name="password" value="{{testUserShortPassword.password}}"/>
        </actionGroup>

        <!-- Verify validation error appears -->
        <waitForElementVisible selector="{{AdminEditUserSection.passwordValidationMessage}}" stepKey="waitForValidationError"/>
        <see userInput="Please enter 12 or more characters, using both numeric and alphabetic." selector="{{AdminEditUserSection.passwordValidationMessage}}" stepKey="seeValidationError"/>

        <!-- Set valid password (16 characters, meets the 12 minimum) -->
        <actionGroup ref="AdminSetUserPasswordAndTestValidationActionGroup" stepKey="setValidPassword">
            <argument name="password" value="{{testUserValidPassword.password}}"/>
        </actionGroup>

        <!-- Verify user was created successfully -->
        <see stepKey="seeSuccessMessage" userInput="You saved the user."/>

        <!-- Verify user appears in grid -->
        <amOnPage url="{{AdminUsersPage.url}}" stepKey="navigateToUsersGrid"/>
        <actionGroup ref="AssertAdminUserIsInGridActionGroup" stepKey="assertUserInGrid">
            <argument name="user" value="testUserShortPassword"/>
        </actionGroup>
    </test>

</tests>
