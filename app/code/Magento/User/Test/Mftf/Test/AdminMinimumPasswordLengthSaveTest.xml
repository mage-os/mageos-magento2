<?xml version="1.0" encoding="utf-8"?>
<!--
/**
 * Copyright 2025 Adobe
 * All Rights Reserved.
 */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">

    <test name="AdminMinimumPasswordLengthSaveTest">
        <annotations>
            <features value="User"/>
            <stories value="Admin Password Length Configuration"/>
            <title value="Admin can save minimum password length configuration"/>
            <description value="Admin should be able to navigate to security config, set password length to 12, save, and verify it persists"/>
            <severity value="AVERAGE"/>
            <testCaseId value="AC-15230"/>
            <useCaseId value="ACP2E-4044"/>
            <group value="user"/>
            <group value="configuration"/>
        </annotations>

        <before>
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
        </before>

        <after>
            <!-- Reset configuration to default value -->
            <actionGroup ref="AdminNavigateToSecurityConfigActionGroup" stepKey="navigateToConfig"/>
            <checkOption selector="{{AdminSecurityConfigSection.minimumPasswordLengthInherit}}" stepKey="resetLengthToDefault"/>
            <actionGroup ref="AdminSaveConfigActionGroup" stepKey="saveConfig"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
        </after>

        <!-- Navigate to Admin Security Configuration -->
        <actionGroup ref="AdminNavigateToSecurityConfigActionGroup" stepKey="navigateToSecurityConfig"/>

        <!-- Test validation: Set password length to 5 (should trigger validation error) -->
        <actionGroup ref="AdminSetMinimumPasswordLengthActionGroup" stepKey="setInvalidPasswordLength">
            <argument name="passwordLength" value="5"/>
        </actionGroup>

        <!-- Try to save configuration with invalid value -->
        <click selector="{{AdminSecurityConfigSection.saveConfigButton}}" stepKey="trySaveInvalidConfig"/>
        <waitForElementVisible selector="{{AdminSecurityConfigSection.fieldValidationMessage}}" stepKey="waitForValidationError"/>
        <see userInput="The value is not within the specified range." selector="{{AdminSecurityConfigSection.fieldValidationMessage}}" stepKey="seeValidationError"/>

        <!-- Set password length to 12 (valid value) -->
        <actionGroup ref="AdminSetMinimumPasswordLengthActionGroup" stepKey="setPasswordLength">
            <argument name="passwordLength" value="12"/>
        </actionGroup>

        <!-- Save configuration -->
        <actionGroup ref="AdminSaveConfigActionGroup" stepKey="saveConfigForValidValue"/>

        <!-- Navigate back to verify the value persists -->
        <actionGroup ref="AdminNavigateToSecurityConfigActionGroup" stepKey="navigateBackToConfig"/>

        <!-- Verify the saved value -->
        <seeInField selector="{{AdminSecurityConfigSection.minimumPasswordLengthField}}" userInput="12" stepKey="verifyPersistedValue"/>
    </test>

</tests>
